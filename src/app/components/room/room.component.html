<div class="room">
  <h3 class="room__title">
    <ng-container *ngIf="activeTicket$ | async as activeTicket else noSelected">
      <ng-container *ngIf="activeTicket.href as href; else text">
        <a class="room__title room__title--link" [href]="href" target="_blank">{{ href }}</a>
      </ng-container>
      <ng-template #text>
        {{ activeTicket.title }}
      </ng-template>
    </ng-container>
    <ng-template #noSelected>
      Please select a ticket for start voting
    </ng-template>
  </h3>

  <div class="room__container">
    <app-cards-board
      *ngIf="!showResults"
      [type]="session?.cardsType"
      (cardClicked)="onCardClicked($event)"
      [selected]="selectedCard">
    </app-cards-board>

    <app-chart
      *ngIf="showResults"
      [currentUser]="currentUser"
      [votes]="votes"
      (setAverage)="onSetAverage($event)"
    ></app-chart>

    <div class="room__side-content">
      <mat-list *ngIf="users$ | async as users">
        <h3 mat-subheader class="room__list-header">
          <span>Members</span>
        </h3>
        <mat-list-item *ngFor="let person of users">
          <img class="room__user-img" (click)="onUserClick(person)" matListAvatar [src]="person.photoURL" alt="">
          <h4 mat-line>{{ person.name }}</h4>
          <span *ngIf="showResults" class="room__vote">{{ person.vote }}</span>
          <mat-icon *ngIf="!showResults && person.voted" class="room__status" aria-hidden="true">check_circle</mat-icon>
        </mat-list-item>
      </mat-list>

      <div class="room__action-buttons">
        <button
          mat-raised-button class="room__button room__button--full-width"
          [routerLink]="['/report', session?.id]"
        >Open Report</button>
      </div>

      <ng-container *ngIf="currentUser?.isAdmin">
        <ng-container *ngIf="activeTicket$ | async as activeTicket else noActiveTicket">
          <div class="room__action-buttons room__action-buttons--primary">
            <button class="room__button" mat-raised-button (click)="onSkipTicket()">{{ showResults ? 'Next Ticket' : 'Skip Ticket' }}</button>
            <button class="room__button" mat-raised-button (click)="onFinishVoting()" *ngIf="!showResults">Finish Voting</button>
          </div>
        </ng-container>
        <ng-template #noActiveTicket>
          <div class="room__action-buttons">
            <button
              mat-raised-button
              (click)="onStartVoting()"
              class="room__button room__button--full-width"
            >Start
          </button>
        </div>
        </ng-template>
      </ng-container>
    </div>
  </div>

  <div class="room__container">
    <div class="room__app-list">
      <app-list
        [currentUser]="currentUser"
        [session]="session"
        [tickets]="tickets"
        (addTicket)="onAddTicket($event)"
        (removeTicket)="onRemoveTicket($event)"
      ></app-list>
    </div>
  </div>
</div>
